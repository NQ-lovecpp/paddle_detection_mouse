---
description: 实验鼠目标检测项目总体架构、数据集、训练体系与部署链路概述
alwaysApply: true
---

# 实验鼠目标检测项目（PaddleDetection + iOS 部署）

## 项目背景

上海交通大学医学院网络信息中心深度学习实习项目。
基于 PaddleDetection 2.6，在双 Tesla T4 GPU 服务器上完成从数据工程到 iOS 移动端部署的全流程。

## 仓库目录结构

```
paddle_detection_mouse/
├── PaddleDetection-release-2.6/      # 主框架（训练、评估、导出）
│   ├── dataset/
│   │   ├── mouse_other_voc/          # 全量数据集（5,828 训练 / 1,458 验证）
│   │   └── mouse_other_voc_1of3/     # 1/3 子集（1,942 训练），用作 baseline 对照
│   ├── configs/
│   │   ├── picodet/runs/             # PicoDet-S 四轮实验配置 L1~L4
│   │   └── yolov3/runs/              # YOLOv3 四轮实验配置 Y1~Y4
│   ├── scripts/
│   │   ├── prepare_1of3_dataset.py   # 生成 1/3 数据集（一次性）
│   │   ├── run_lightweight.py        # PicoDet-S 四轮链式训练启动器
│   │   └── run_yolov3.py             # YOLOv3 四轮链式训练启动器
│   └── output/                       # 训练输出（权重、日志、VDL）
├── Mobile_Deployment/
│   ├── MouseDetectionApp/            # React Native iOS App（正式版，已可运行）
│   │   ├── ios/MouseDetectionApp/ImagePreprocessor.swift  # 原生 Swift 预处理
│   │   └── src/services/ModelService.ts                   # ONNX Runtime 推理
│   ├── MouseDetectionApp_code/       # 早期 TS 代码草稿（仅参考）
│   ├── MouseDetectionApp_tmp/        # RN 初始脚手架（仅参考）
│   └── models/                       # ONNX 模型文件（yolov3_mouse_fp32.onnx）
└── Training_Pipeline.md              # 完整训练文档（含历史日志）
```

## 数据集说明

- **二分类**：`mouse`（实验鼠）/ `other`（其他）
- **全量**：7,286 张（5,828 训练 + 1,458 验证），VOC 格式
- **1/3 子集**：1,942 训练张，验证集与全量共用（保证 mAP 可横向对比）
- 图像路径格式：`./images/xxx.jpg ./annotations/xxx.xml`

## 实验方案（4×2 共 8 组）

| 组别 | 模型 | 数据 | 卡数 | LR | 说明 |
|------|------|------|------|----|------|
| L1 | PicoDet-S | 全量 | 1 | 0.08 | 单卡基准 |
| L2 | PicoDet-S | 全量 | 2 | 0.16 | 官方推荐 |
| L3 | PicoDet-S | 全量 | 2 | 0.24 | 大 bs=96 |
| L4 | PicoDet-S | 全量 | 2 | 0.16 | 600 epoch |
| Y1 | YOLOv3-MV1 | 1/3 | 1 | 0.00125 | baseline |
| Y2 | YOLOv3-MV1 | 1/3 | 2 | 0.0025 | |
| Y3 | YOLOv3-MV1 | 全量 | 1 | 0.00125 | |
| Y4 | YOLOv3-MV1 | 全量 | 2 | 0.0025 | 目标最优 |

LR 缩放规则：`lr = base_lr × (total_batch_size / reference_bs)`
- PicoDet：reference_bs=64，base_lr=0.16
- YOLOv3：reference_bs=64，base_lr=0.01

## 部署链路

```
best_model.pdparams
  → export_model.py（Paddle Inference 格式）
  → paddle2onnx（ONNX Opset 11）
  → iOS App（ONNX Runtime React Native + Swift 原生预处理）
```

## 关键结论（已知）

- PicoDet-S L1（单卡 300e）：**mAP@0.5 = 94.30%**，peak 在 epoch 70，之后轻微过拟合
- YOLOv3 旧基线（Training_Pipeline.md 方案 A）：93.63%
- iOS 部署：YOLOv3 FP32 92MB → 1 fps（IO 慢 + 无 CoreML 加速）；PicoDet-S 预期 15-30 fps
